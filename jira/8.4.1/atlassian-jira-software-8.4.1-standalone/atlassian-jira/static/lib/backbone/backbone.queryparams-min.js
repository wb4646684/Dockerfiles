/*! THIS FILE HAS BEEN MODIFIED BY ATLASSIAN, SEE https://github.com/jhudson8/backbone-query-parameters/pull/63/files */
define("jira/backbone-queryparams",["underscore"],function(t){return function(e){function r(e,r,a){t.each(Array.prototype.slice.call(arguments,2),function(t){Object.defineProperty(r,t,{get:function(){return e[t]},set:function(r){e[t]=r}})})}function a(t){var e=t.location,a={};r(e,a,"assign","ancestorOrigins","origin","hash","search","pathname","port","hostname","host","protocol","href","reload"),a.replace=function(){e.replace(t.root+"#"+t.fragment)},a.unPatch=function(){return t.location=e},t.location=a}function n(t){var e=t.history,a={};r(e,a,"length","state","back","forward","go","pushState"),a.replaceState=function(r,a,n){return n=t.root+t.fragment,e.replaceState(r,a,n)},a.unPatch=function(){t.history=e},t.history=a}function i(e,r){var a=e.split("&");t.each(a,function(t){var e=t.split("=");r(e.shift(),e.join("="))})}var o=/^\?(.*)/,s=/\((.*?)\)/g,c=/(\(\?)?:\w+/g,u=/\*\w+/g,h=/[\-{}\[\]+?.,\\\^$|#\s]/g,l=/^([^\?]*)/,p=/[\:\*]([^\:\?\/]+)/g,f=/^[#\/]|\s+$/g,m=/\/$/;e.Router.arrayValueSplit="|";var g=function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var r=this.root.replace(m,""),a=this.location.search;t.indexOf(r)||(t=t.substr(r.length)),a&&(t+=a)}else t=this.getHash();return t.replace(f,"")};r.isSupported=function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}();var d=e.History.prototype.start,y=e.History.prototype.loadUrl;t.extend(e.History.prototype,{getFragment:g,getQueryParameters:function(e,r){e=g.apply(this,arguments);var a=e.replace(l,""),n=a.match(o);if(n){a=n[1];var s={};return i(a,function(e,r){r=r.replace(/\+/g,"%20"),r=decodeURIComponent(r),s[e]?t.isString(s[e])?s[e]=[s[e],r]:s[e].push(r):s[e]=r}),s}return{}},start:function(){r.isSupported&&(a(this),n(this));try{return d.apply(this,arguments)}finally{this.location.unPatch&&this.location.unPatch(),this.history.unPatch&&this.history.unPatch()}},loadUrl:function(){return this.location&&this.location.unPatch&&this.location.unPatch(),this.history&&this.history.unPatch&&this.history.unPatch(),y.apply(this,arguments)}}),t.extend(e.Router.prototype,{initialize:function(t){this.encodedSplatParts=t&&t.encodedSplatParts},getFragment:g,_routeToRegExp:function(e){var r=u.exec(e)||{index:-1},a=c.exec(e)||{index:-1},n=e.match(p)||[];e=e.replace(h,"\\$&").replace(s,"(?:$1)?").replace(c,function(t,e){return e?t:"([^\\/\\?]+)"}).replace(u,"([^??]*?)"),e+="(\\?.*)?";var i=new RegExp("^"+e+"$");return r.index>=0&&(i.splatMatch=a>=0?r.index-a.index:-1),i.paramNames=t.map(n,function(t){return t.substring(1)}),i.namedParameters=this.namedParameters,i},_extractParameters:function(r,a){var n=r.exec(a).slice(1),s={};n.length>0&&t.isUndefined(n[n.length-1])&&n.splice(n.length-1,1);var c=n.length&&n[n.length-1]&&n[n.length-1].match(o);if(c){var u=c[1],h={};if(u){var l=this;i(u,function(t,e){l._setParamValue(t,e,h)})}n[n.length-1]=h,t.extend(s,h)}var p=n.length;if(r.splatMatch&&this.encodedSplatParts){if(r.splatMatch<0)return n;p-=1}for(var f=0;f<p;f++)t.isString(n[f])&&(n[f]=decodeURIComponent(n[f]),r.paramNames&&r.paramNames.length>=f-1&&(s[r.paramNames[f]]=n[f]));return e.Router.namedParameters||r.namedParameters?[s]:n},_setParamValue:function(t,e,r){t=t.replace("[]","");for(var a=t.split("."),n=r,i=0;i<a.length;i++){var o=a[i];i===a.length-1?n[o]=this._decodeParamValue(e,n[o]):n=n[o]=n[o]||{}}},_decodeParamValue:function(r,a){r=r.replace(/\+/g,"%20");var n=e.Router.arrayValueSplit;if(n&&r.indexOf(n)>=0){for(var i=r.split(n),o=i.length-1;o>=0;o--)i[o]?i[o]=decodeURIComponent(i[o]):i.splice(o,1);return i}return r=decodeURIComponent(r),a?t.isArray(a)?(a.push(r),a):[a,r]:r},toFragment:function(e,r){return r&&(t.isString(r)||(r=this._toQueryString(r)),r&&(e+="?"+r)),e},_toQueryString:function(r,a){function n(t){return String(t).replace(i,encodeURIComponent(i))}var i=e.Router.arrayValueSplit;if(!r)return"";a=a||"";var o="";for(var s in r){var c=r[s];if(t.isString(c)||t.isNumber(c)||t.isBoolean(c)||t.isDate(c))c=this._toQueryParam(c),(t.isBoolean(c)||t.isNumber(c)||t.isString(c)||c)&&(o+=(o?"&":"")+this._toQueryParamName(s,a)+"="+n(encodeURIComponent(c)));else if(t.isArray(c)){for(var u="",h=0;h<c.length;h++){var l=this._toQueryParam(c[h]);(t.isBoolean(l)||null!==l)&&(u+=i+n(l))}u&&(o+=(o?"&":"")+this._toQueryParamName(s,a)+"="+u)}else{var p=this._toQueryString(c,this._toQueryParamName(s,a,!0));p&&(o+=(o?"&":"")+p)}}return o},_toQueryParamName:function(t,e,r){return e+t+(r?".":"")},_toQueryParam:function(e){return t.isNull(e)||t.isUndefined(e)?null:e}})}});
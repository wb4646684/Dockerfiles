define("jira/customfields/customfieldsFilterView",["atlassian/libs/underscore-1.8.3","jira/marionette-4.1","jira/util/formatter","jira/customfields/customfieldsFilterDropdownView","jira/customfields/customfieldsFilterProjectCollection","jira/customfields/customfieldsFilterTypesCollection","jira/customfields/customfieldsFilterScreensCollection"],function(e,t,i,o,r,s,n){"use strict";return t.View.extend({template:JIRA.Templates.Admin.Customfields.filterContainer,ui:{searchInput:"#custom-fields-filter-text",projectsTrigger:"#projects-dropdown-trigger",typesTrigger:"#types-dropdown-trigger",screensTrigger:"#screens-dropdown-trigger",projectsDropdown:"#projects-filter-dropdown",typesDropdown:"#types-filter-dropdown",screensDropdown:"#screens-filter-dropdown",container:".customfield-filter-items"},regions:{screens:{el:"#screens-filter-dropdown",replaceElement:!0},types:{el:"#types-filter-dropdown",replaceElement:!0},projects:{el:"#projects-filter-dropdown",replaceElement:!0}},events:{"input @ui.searchInput":"performTextSearch","aui-dropdown2-show @ui.projectsDropdown":function(){this.projectsDropdownView.reorderItems(),this.projectsDropdownView.focusField()},"aui-dropdown2-show @ui.typesDropdown":function(){this.typesDropdownView.reorderItems(),this.typesDropdownView.focusField()},"aui-dropdown2-show @ui.screensDropdown":function(){this.screensDropdownView.reorderItems(),this.screensDropdownView.focusField()}},childViewEvents:{"filter:changed":"onChildviewFilterChanged","filter:cleared":"onChildviewFilterCleared"},initialize:function(){this.projectFilterCollection=new r,this.typesFilterCollection=new s,this.screensFilterCollection=new n,this.projectsDropdownView=new o({collection:this.projectFilterCollection,id:"projects-filter-dropdown",customfieldCollection:this.collection}),this.typesDropdownView=new o({collection:this.typesFilterCollection,id:"types-filter-dropdown",customfieldCollection:this.collection}),this.screensDropdownView=new o({collection:this.screensFilterCollection,id:"screens-filter-dropdown",customfieldCollection:this.collection})},onRender:function(){this.unwrapTemplate(),this.showChildView("projects",this.projectsDropdownView),this.showChildView("types",this.typesDropdownView),this.showChildView("screens",this.screensDropdownView),this.setButtonsText(this.projectFilterCollection),this.setButtonsText(this.screensFilterCollection),this.setButtonsText(this.typesFilterCollection)},onChildviewFilterChanged:function(t){var i=t.model.collection,o=i.id,r=t.getUI("filter"),s=r.val(),n=r.prop("checked"),c=this.collection.filters[o];n&&!e.contains(c,s)?c.push(s):!n&&e.contains(c,s)&&c.splice(c.indexOf(s),1),this.setButtonsText(i),this.performSearch()},onChildviewFilterCleared:function(e){this.setButtonsText(e),this.performSearch()},performSearch:function(){var e=this;this.triggerMethod("search:start"),this.collection.getFirstPage({reset:!0}).always(function(){e.triggerMethod("search:end")}).fail(function(t){return e.triggerMethod("navigate:error",t)})},performTextSearch:e.debounce(function(){var e=this,t=this.getUI("searchInput"),i=t.val();i!==this.currentInputValue&&(this.triggerMethod("search:start"),t.blur(),this.currentInputValue=i,this.collection.searchTerm=i,this.collection.getFirstPage({reset:!0}).always(function(){t.focus(),e.triggerMethod("search:end")}).fail(function(t){return e.triggerMethod("navigate:error",t)}))},500),currentInputValue:"",setButtonsText:function(e){var t=e.id,i=e.name,o=this.getUI(i+"Trigger"),r=this.collection.filters[t]||[],s=this._getAppliedFilterNames(i,r);o.text(s)},_getDefaultButtonText:function(e){var t=void 0;switch(e){case"projects":t=i.I18n.getText("common.words.project");break;case"screens":t=i.I18n.getText("admin.common.words.screen");break;case"types":t=i.I18n.getText("admin.common.words.type")}return t+": "+i.I18n.getText("common.words.all")},_getAppliedFilterNames:function(t,i){if(!i||!i.length)return this._getDefaultButtonText(t);var o=void 0;switch(t){case"projects":o=this.projectFilterCollection;break;case"screens":o=this.screensFilterCollection;break;case"types":o=this.typesFilterCollection}return o.reduce(function(t,o){return e.contains(i,o.id.toString())&&o.get("name").length>0&&t.push(o.get("name")),t},[]).join(", ")}})});
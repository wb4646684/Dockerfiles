define("jira/share/controllers/edit-shares-model",["aui/message","jquery"],function(e,t){"use strict";function i(e){this.mode=e,this.counter=0,this.displayDiv=this.getModeElementById("share_display_div"),this.emptyDiv=this.getModeElementById("empty_share"),this.shareDiv=this.getModeElementById("share_div")}return i.prototype={initialise:function(){var e=this.getModeElementById("share_busy");e&&(e.style.display="none",e.parentNode&&e.parentNode.removeChild(e)),this.shareDiv.style.display=""},setupDefaultShareType:function(){var e=this.getModeElementById("share_type_selector"),t=e.options,i=t[e.selectedIndex].value;return this.getModeElementById("share_"+i).style.display="",i},onFilterEdit:function(e){if("viewers"===this.mode){var t=document.getElementById("share_type_hidden_editors");if(t)try{var i=JSON.parse(e.value);i.forEach(function(e){e.rights={value:1}});var n=JSON.parse(t.value);n.forEach(function(e){e.rights={value:3}}),e.value=JSON.stringify(i.concat(n)),t.parentNode.removeChild(t)}catch(e){console.log("Error parsing JSON data: "+e)}this.removeEditorsSelect("group-share"),this.removeEditorsSelect("project-share"),this.removeEditorsSelect("role-share")}},setWarning:function(t,i){var n=document.getElementById("share_warning");n&&(t.length>0?e.warning("#share_warning",{body:t,title:i,closeable:!1,shadowed:!1}):n.innerHTML="")},getModeElementById:function(e){return document.getElementById(e+"_"+this.mode)},removeEditorsSelect:function(e){var t=document.querySelector(".editors select."+e);t&&t.parentNode.removeChild(t)},animateShare:function(e){var i=this.getModeElementById("share_div_"+e+"_inner");if(i){for(var n=i.parentNode,r=null;!r&&n&&n!==document.body.parentNode;)n.style&&(r=n.style.backgroundColor),!r&&n.bgColor&&(r=n.bgColor),n=n.parentNode;r||(r="#FFFFFF"),t(i).hasClass("fading")||(t(i).addClass("fading"),t(i).css({backgroundColor:"#FFCCCC"}).animate({backgroundColor:"#FFFFFF"},2e3,function(){t(i).removeClass("fading")}))}},addDisplay:function(e,i,n){var r=this.counter++;i.className="shareItem",i.id="share_div_"+r+"_"+this.mode;var s=document.createElement("div"),a="share_div_"+r+"_inner_"+this.mode;s.id=a,s.title=e.description;var d=this.cloneImage("share_icon");d&&s.appendChild(d);var o=document.createElement("span");o.id=a+"_span",e.dataSpanId=o.id,o.innerHTML=e.display,s.appendChild(o);var l=this.cloneImage("share_trash");return l&&(t(l).click(function(e){n(e,r)}),s.appendChild(l)),i.appendChild(s),this.appendToDisplayDiv(i),e.key&&e.updateDisplayName(),r},remove:function(e,t){var i=this.getModeElementById("share_div_"+e);t>=1?this.displayDiv.removeChild(i):(i.innerHTML=this.emptyDiv.innerHTML,i.className=this.emptyDiv.className,i.removeAttribute("id"))},clearDiv:function(){for(;this.displayDiv.firstChild;){if("div"===this.displayDiv.firstChild.nodeName.toLowerCase()){for(var e=this.displayDiv.firstChild;e.nextSibling;)this.displayDiv.removeChild(e.nextSibling);return e}this.displayDiv.removeChild(this.displayDiv.firstChild)}},recalculateHiddenValue:function(e){var t=this.getModeElementById("share_type_hidden");if(t){var i=e.map(function(e){return e.permission});t.value=JSON.stringify(i)}},appendToDisplayDiv:function(e){this.displayDiv.appendChild(e)},displayEmptySharesTemplate:function(){var e=this.emptyDiv.cloneNode(!0);e.removeAttribute("id"),e.style.display="",this.appendToDisplayDiv(e)},getSelectedType:function(){for(var e=this.getModeElementById("share_type_selector"),t=e.options,i=void 0,n=0;n<t.length;n++){var r=this.getModeElementById("share_"+t[n].value);r&&(n===e.selectedIndex?i=r:r.style.display="none")}return i.style.display="",t[e.selectedIndex].value},cloneImage:function(e){var t=this.getModeElementById(e);return t&&(t=t.cloneNode(!0),t.removeAttribute("id"),t.style.display=""),t},getSelectList:function(){return this.getModeElementById("share_type_selector")},getShareTypeSelector:function(){return t("#share_type_selector_"+this.mode)},getSubmitButton:function(){return this.getForm().find("input[type=submit]")},getForm:function(){return t("#edit-entity")}},i});
define("jira/viewissue/watchers-voters/toggler",["require"],function(t){var e=t("jira/ajs/ajax/smart-ajax"),a=t("jira/flag"),o=t("jquery"),n=t("wrm/context-path"),i=t("jira/util/formatter"),s=function(t,a,i,s,l){var c,u=a+"-on",g=a+"-off",f="/voters",d=t.next(".icon"),x="POST";t.hasClass(u)&&(x="DELETE"),-1!==a.indexOf("watch")&&(f="/watchers"),t.removeClass(u).removeClass(g),"POST"===x&&(c={dummy:!0}),o(e.makeRequest({url:n()+"/rest/api/1.0/issues/"+t.attr("rel")+f,type:x,dataType:"json",data:c,contentType:"application/json",complete:function(e,a,o){var n="POST"===x;o.successful?(n?(t.addClass(u),t.text(l.titleOn),s.attr("title",l.titleOn).text(l.textOn)):(t.addClass(g),t.text(l.titleOff),s.attr("title",l.titleOff).text(l.textOff)),i.text(o.data.count),i.toggleClass("jira-badge__primary",n)):(o.aborted||r(o),n?(t.addClass(g),t.text(l.titleOff),s.attr("title",l.titleOff).text(l.textOff)):(t.addClass(u),t.text(l.titleOn),s.attr("title",l.titleOn).text(l.textOn)))}})).throbber({target:d})},r=function(t){var o=e.buildSimpleErrorContent(t,{alert:!0});if(t.hasData){var n=JSON.parse(t.data);n.errorMessages&&(o=n.errorMessages[0])}a.showErrorMsg(o,{closeable:!0})};o(document).delegate("#toggle-vote-issue","click",function(t){t.preventDefault(),o("#vote-toggle").click()}),o(document).delegate("#toggle-watch-issue","click",function(t){t.preventDefault(),o("#watching-toggle").click()});var l=function(t){o("input[type=hidden][id|=error]").each(function(e,a){var o=a.id.replace("error-","");t[o]=a.value})};o(document).delegate("#vote-toggle","click",function(t){t.preventDefault();var e={titleOn:i.I18n.getText("issue.operations.simple.voting.alreadyvoted"),titleOff:i.I18n.getText("issue.operations.simple.voting.notvoted"),textOn:i.I18n.getText("issue.operations.simple.unvote"),textOff:i.I18n.getText("issue.operations.simple.vote"),actionTextOff:i.I18n.getText("common.concepts.vote"),actionTextOn:i.I18n.getText("common.concepts.voted")},a=o(this),n=o(document.querySelectorAll("#vote-data")),r=o(document.querySelectorAll("#toggle-vote-issue .trigger-label"));l(e),s(a,"vote-state",n,r,e)}),o(document).delegate("#watching-toggle","click",function(t){t.preventDefault();var e={titleOn:i.I18n.getText("issue.operations.simple.stopwatching"),titleOff:i.I18n.getText("issue.operations.simple.startwatching"),textOn:i.I18n.getText("issue.operations.unwatch"),textOff:i.I18n.getText("issue.operations.watch"),actionTextOff:i.I18n.getText("common.concepts.watch"),actionTextOn:i.I18n.getText("common.concepts.watching")},a=o(this),n=o(document.querySelectorAll("#watcher-data")),r=o(document.querySelectorAll("#toggle-watch-issue .trigger-label"));l(e),s(a,"watch-state",n,r,e)})});
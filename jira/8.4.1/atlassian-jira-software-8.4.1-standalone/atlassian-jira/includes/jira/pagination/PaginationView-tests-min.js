AJS.test.require("jira.webresources:pagination-view",function(){"use strict";require(["jira/pagination/paginationview","jquery"],function(e,t){module("PaginationView",{setup:function(){var i=t('<ol class="aui-nav aui-nav-pagination">    <li class="aui-nav-previous"><a href="" data-page="1">Prev</a></li></ol>');this.view=new e({el:i,collection:{getPage:sinon.stub(),on:sinon.stub(),off:sinon.stub(),mode:"client",state:{firstPage:1,lastPage:20,currentPage:1},Events:[]},model:{getQueryParams:sinon.stub().returns(""),on:sinon.stub(),off:sinon.stub()}}),this.view.bindUIElements()}}),test("Should change page and trigger navigate event on page click in client mode.",function(){var e=sinon.spy();this.view.on("navigate",e),t(this.view.ui.page[0]).click(),sinon.assert.calledOnce(e),sinon.assert.calledWith(e,1),sinon.assert.calledWith(this.view.collection.getPage,1)}),test("Should change page and trigger navigation events on page click in server mode.",function(){var e=sinon.spy(),i=sinon.spy(),n=sinon.spy();this.view.collection.mode="server",this.view.collection.getPage.returns((new t.Deferred).resolve()),this.view.on("navigate",e),this.view.on("navigate:start",i),this.view.on("navigate:end",n),t(this.view.ui.page[0]).click(),sinon.assert.calledOnce(e),sinon.assert.calledWith(e,1),sinon.assert.calledOnce(i),sinon.assert.calledOnce(n),sinon.assert.calledWith(this.view.collection.getPage,1)}),test("Should not change page and trigger navigation error event on page click in server mode failure.",function(){var e=sinon.spy(),i=sinon.spy(),n=sinon.spy(),a=sinon.spy();this.view.collection.mode="server",this.view.collection.getPage.returns((new t.Deferred).reject()),this.view.on("navigate",e),this.view.on("navigate:start",i),this.view.on("navigate:error",n),this.view.on("navigate:end",a),t(this.view.ui.page[0]).click(),sinon.assert.notCalled(e),sinon.assert.calledOnce(i),sinon.assert.calledOnce(n),sinon.assert.calledOnce(a),sinon.assert.calledWith(this.view.collection.getPage,1)}),test("First page should be calculated correctly",function(){this.view.collection.state.currentPage=1;var e=this.view.templateContext();equal(e.firstPage,1),this.view.collection.state.currentPage=6,e=this.view.templateContext(),equal(e.firstPage,1),this.view.collection.state.currentPage=7,e=this.view.templateContext(),equal(e.firstPage,2),this.view.collection.state.currentPage=10,e=this.view.templateContext(),equal(e.firstPage,5)}),test("Last page should be calculated correctly",function(){this.view.collection.state.currentPage=20;var e=this.view.templateContext();equal(e.lastPage,20),this.view.collection.state.currentPage=15,e=this.view.templateContext(),equal(e.lastPage,20),this.view.collection.state.currentPage=14,e=this.view.templateContext(),equal(e.lastPage,19),this.view.collection.state.currentPage=10,e=this.view.templateContext(),equal(e.lastPage,15)})})});